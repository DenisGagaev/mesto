(()=>{"use strict";class t{constructor(t,e,s,r,i,o,n){this._data=t,this._cardSelector=e,this._userId=s,this._cardId=t._id,this._cardOwnerId=t.owner._id,this._imagePopup=r,this._element=this._getTemplate(),this._likeButton=this._element.querySelector(".element__like"),this._deleteButton=this._element.querySelector(".elements__delete"),this._likeCounter=this._element.querySelector(".element__like-counter"),this._ImageElement=this._element.querySelector(".element__image"),this._deleteCard=i,this._addCardLike=o,this._deleteCardLike=n,this._classLikeActive="element__like_active"}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}generateCard(){this._setEventListeners();const t=this._element.querySelector(".element__text");return this._ImageElement.alt=this._data.name,this._ImageElement.src=this._data.link,t.textContent=this._data.name,this._likeCounter.textContent=this._data.likes.length,this._setIsLiked(),this._element}_setEventListeners(){this._cardOwnerId===this._userId&&(this._deleteButton.classList.add("elements__delete_active"),this._deleteButton.addEventListener("click",(()=>this._deleteFotoCard()))),this._likeButton.addEventListener("click",(()=>this._toggleLike())),this._ImageElement.addEventListener("click",this._imagePopup)}_toggleLike(){this._likeButton.classList.contains(this._classLikeActive)?this._deleteCardLike(this._cardId).then((t=>{this._data=t,this._likeCounter.textContent=t.likes.length,this._likeButton.classList.remove(this._classLikeActive)})).catch((t=>console.log(t))):this._addCardLike(this._cardId).then((t=>{this._data=t,this._likeCounter.textContent=t.likes.length,this._likeButton.classList.add(this._classLikeActive)})).catch((t=>console.log(t)))}_deleteFotoCard(){const t={card:this._element,cardId:this._cardId};this._deleteCard(t)}_setIsLiked(){this._data.likes.some((t=>t._id===this._userId))&&this._likeButton.classList.add(this._classLikeActive)}}const e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible",inputError:".popup__input-error"};class s{constructor(t,e){this._form=e,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inputErrorClass=t.inputErrorClass,this._inactiveButtonClass=t.inactiveButtonClass,this._errorClass=t.errorClass,this._inputError=t.inputError,this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector))}_showInputError(t){this._errorElement=this._form.querySelector("#".concat(t.id,"-error")),t.classList.add(this._inputErrorClass),this._errorElement.classList.add(this._errorClass),this._errorElement.textContent=this._element.validationMessage}_hideInputError(t){this._errorElement=this._form.querySelector("#".concat(t.id,"-error")),t.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""}_isValid(t){this._element=t,this._element.validity.valid?this._hideInputError(t):this._showInputError(t)}_hasInvalidInput(){return this._inputs.some((t=>!t.validity.valid))}_disableButton(){this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._inactiveButtonClass)}toggleSubmit(){this._hasInvalidInput()?this._disableButton():(this._buttonElement.removeAttribute("disabled",!0),this._buttonElement.classList.remove(this._inactiveButtonClass))}_setEventListeners(){this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._inputs.forEach((t=>{t.addEventListener("input",(()=>{this._isValid(t),this.toggleSubmit()}))}))}enableValidation(){this._setEventListeners(),this._form.addEventListener("submit",(t=>t.preventDefault()),this.toggleSubmit())}hideAllErrors(){this._inputs.forEach((t=>{this._hideInputError(t)})),this._disableButton()}}class r{constructor(t){this._popup=document.querySelector(t),this._popupOverlay=this._popup.querySelector(".popup__overlay"),this._closePopup=this._popup.querySelector(".popup__close"),this._handleEscClose=this._handleEscClose.bind(this),this._classOpenedPopup="popup_opened"}get popup(){return this._popup}open(){document.addEventListener("keydown",this._handleEscClose),this._popup.classList.add(this._classOpenedPopup)}close(){document.removeEventListener("keydown",this._handleEscClose),this._popup.classList.remove(this._classOpenedPopup)}_handleEscClose(t){"Escape"===t.key&&this.close()}setEventListeners(){this._closePopup.addEventListener("click",(()=>{this.close()})),this._popupOverlay.addEventListener("click",(()=>{this._popup.classList.contains(this._classOpenedPopup)&&this.close()}))}}class i extends r{constructor(t,e){let{formSubmitCallBack:s}=e;super(t),this._formSubmitCallBack=s,this._formSubmit=this._formSubmit.bind(this),this._form=super.popup.querySelector(".popup__form"),this._inputs=Array.from(this._form.querySelectorAll(".popup__input")),this._submitButton=this._form.querySelector(".popup__button")}_formSubmit(){this._formSubmitCallBack(this._getInputValues(),this._submitButton)}_getInputValues(){const t={};return this._inputs.forEach((e=>{t[e.name]=e.value})),t}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",this._formSubmit)}}const o=document.querySelector("#popup__form-profile"),n=document.querySelector("#popup__Profile"),a=document.querySelector("#popup__card"),l=document.querySelector("#popap__avatar"),_=o.querySelector("#popup__name-input"),c=o.querySelector("#popup__text-input"),u=document.querySelector(".profile__name"),h=document.querySelector(".profile__text"),p=document.querySelector(".profile__avatar"),d=document.querySelector(".profile__avatar-batton"),m=document.querySelector(".elements"),f=document.querySelector(".profile__edit"),v=document.querySelector(".profile__addfoto-button"),E=new class{constructor(t){this._baseUrl=t.serverUrl,this._token=t.token}_requestResult(t){return t.ok?t.json():Promise.reject("Хьюстон, у нас проблемы: Ошибка ".concat(t.status," ").concat(t.statusText))}getUserInfo(){return fetch("".concat(this._baseUrl,"users/me"),{headers:{authorization:this._token}}).then((t=>this._requestResult(t)))}editProfile(t){return fetch("".concat(this._baseUrl,"users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name.trim(),about:t.about.trim()})}).then((t=>this._requestResult(t)))}getInitialCards(){return fetch("".concat(this._baseUrl,"cards"),{headers:{authorization:this._token}}).then((t=>this._requestResult(t)))}editAvatar(t){return fetch("".concat(this._baseUrl,"users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.avatarLink})}).then((t=>this._requestResult(t)))}sendCard(t){return fetch("".concat(this._baseUrl,"cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then((t=>this._requestResult(t)))}deleteCard(t){return fetch("".concat(this._baseUrl,"cards/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then((t=>this._requestResult(t)))}addCardLike(t){return fetch("".concat(this._baseUrl,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._token}}).then((t=>this._requestResult(t)))}deleteCardLike(t){return fetch("".concat(this._baseUrl,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then((t=>this._requestResult(t)))}}({serverUrl:"https://mesto.nomoreparties.co/v1/cohort-27/",token:"8747a9a0-014b-48d6-8e47-516b00c90197"});let k,b,C;const S=[E.getUserInfo(),E.getInitialCards()],L=new s(e,n),y=new s(e,a),g=new s(e,l);L.enableValidation(),y.enableValidation(),g.enableValidation();const I=t=>{t.textContent="Сохранение..."},q=t=>{t.textContent="Сохранить"},x=t=>{const e={link:t.target.src,text:t.target.closest(".element").querySelector(".element__text").textContent};B.open(e)},B=new class extends r{constructor(t){super(t),this._imageElement=super.popup.querySelector(".popup__photo"),this._popupImageSubtitle=super.popup.querySelector(".popup__image-subtitle")}open(t){let{text:e,link:s}=t;this._imageElement.src=s,this._imageElement.alt=e,this._popupImageSubtitle.textContent=e,super.open()}}("#popap__image");B.setEventListeners();const A=t=>{U.data=t,U.open()},w=e=>new t(e,"#cardTemplate",k,x,A,b=t=>E.addCardLike(t),C=t=>E.deleteCardLike(t)).generateCard(e),U=new class extends r{constructor(t,e){let{formSubmitCallBack:s}=e;super(t),this._formSubmitCallBack=s,this._form=super.popup.querySelector(".popup__form"),this._submit=this._submit.bind(this)}_submit(t){t.preventDefault(),this._formSubmitCallBack(this.data)}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",this._submit)}}("#popap__deleteCard",{formSubmitCallBack:t=>{E.deleteCard(t.cardId).then((()=>{t.card.remove(),U.close()})).catch((t=>console.log(t)))}});U.setEventListeners();const P=new class{constructor(t,e){let{renderItems:s}=t;this._renderer=s,this._container=e}renderItems(t){t.forEach((t=>{this._renderer(t)}))}addItem(t){this._container.prepend(t)}}({renderItems:t=>{P.addItem(w(t))}},m),T=new i("#popup__card",{formSubmitCallBack:(t,e)=>{I(e);const s={name:t.photoText,link:t.photoLink};E.sendCard(s).then((t=>{P.addItem(w(t),!0),T.close()})).catch((t=>console.log(t))).finally((()=>{q(e)}))}});T.setEventListeners();const O=new class{constructor(t){let{profileName:e,profileText:s,profileAvatar:r}=t;this._name=e,this._text=s,this._profileAvatar=r}getUserInfo(){return{name:this._name.textContent,text:this._text.textContent}}setUserInfo(t){this._name.textContent=t.name,this._text.textContent=t.about}setAvatarInfo(t){this._profileAvatar.style.backgroundImage='url("'.concat(t.avatar,'")')}}({profileName:u,profileText:h,profileAvatar:p}),R=new i("#popup__Profile",{formSubmitCallBack:(t,e)=>{I(e),E.editProfile(t).then((t=>{O.setUserInfo(t),R.close()})).catch((t=>console.log(t))).finally((()=>{(t=>{t.textContent="Создать"})(e)}))}});R.setEventListeners();const z=new i("#popap__avatar",{formSubmitCallBack:(t,e)=>{I(e),E.editAvatar(t).then((t=>{O.setAvatarInfo(t),z.close()})).catch((t=>console.log(t))).finally((()=>{q(e)}))}});z.setEventListeners(),f.addEventListener("click",(()=>{const t=O.getUserInfo();L.hideAllErrors(),_.value=t.name,c.value=t.text,R.open()})),v.addEventListener("click",(()=>{T.open(),y.hideAllErrors()})),d.addEventListener("click",(()=>{z.open(),g.hideAllErrors()})),Promise.all(S).then((t=>{let[e,s]=t;k=e._id,O.setUserInfo(e),O.setAvatarInfo(e),P.renderItems(s.reverse())})).catch((t=>console.log(t)))})();